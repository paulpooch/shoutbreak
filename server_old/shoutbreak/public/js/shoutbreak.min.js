var SB=function(a,b,c){console.log("new SB(map, server) created");var d=this;var e=[];var f=false;var g=typeof io==="undefined"?null:io.connect(b);var h=function(){console.log("SB.listen()");g.on("update",function(a){console.log("socket.io 'update' event fired");if(f){k(a)}else{j(a);f=true}})};var j=function(b){console.log("SB.fill(shouts)");e=b;a.update(e)};var k=function(b){console.log("SB.append(shouts)");var d;var f;for(i=0;i<b.length;i++){e.push(b[i])}d=e.length;f=d-c;if(f>0){e.splice(0,f)}a.update(e)};if(g){h()}else{$("#view_map").remove()}};var Map=function(a){console.log("new Map(canvas) created");var b=this;var c=new google.maps.LatLng(40.9792645,-74.1165313);var d={zoom:7,center:c,mapTypeId:google.maps.MapTypeId.ROADMAP};var e=new google.maps.Map(a[0],d);var f=null;var g=[];var h={};var i=[];var j=new google.maps.InfoWindow({content:"null"});var k=function(){console.log("Map.clearMap()");if(i!==undefined){google.maps.event.clearListeners(e,"click");for(var a=0;a<i.length;a++){var b=i[a];b.setMap(null)}h={};i=[]}};var l=function(){console.log("Map.rehash()");var b;var c;var d;var m;var n;var o;var p;var q;var r;var s;var t=20;var u=20;var v;var w;var x;var y;var z;var A;var B;var C;var D;var E;var F;var G;var H;var I;var J;if(f==null){console.log("mapBounds null, retrying Map.rehash()");setTimeout(l,300)}else if(g.length>0){console.log("rehashing...");b=f.getNorthEast();c=f.getSouthWest();d=c.lng();m=b.lng();n=c.lat();o=b.lat();p=a.width();q=a.height();x=Math.round(p/t);y=Math.round(q/u);v=Math.abs(m-d)/x;w=Math.abs(o-n)/y;k();for(E=0;E<g.length;E++){F=g[E];if(F.lng>d&&F.lng<m&&F.lat>n&&F.lat<o){B=d+Math.floor((F.lng-d)/v)*v;C=n+Math.floor((F.lat-n)/w)*w;G=h[B];if(G===undefined){G={};h[B]=G}H=h[B][C];if(H===undefined){H={};h[B][C]=H}H[F.shout_id]=F}}for(B in h){G=h[B];if(G!==undefined){for(C in G){H=G[C];if(H!==undefined){z=parseFloat(C)+w/2;A=parseFloat(B)+v/2;s=new google.maps.LatLng(z,A);I=[];for(D in H){F=H[D];I+="<p>"+F.txt+'</p><p class="date">'+F.date+"</p>"}r=new google.maps.Marker({position:s,map:e,draggable:false,animation:null,content:I});J=google.maps.event.addListener(r,"click",function(){var a=this;var b='<div id="info_window">'+a.content+"</div>";j.setContent(b);j.open(e,a)});r.listener=J;i.push(r)}}}}}else{console.log("no shouts to rehash")}};this.update=function(a){console.log("Map.update()");g=a;l()};this.resize=function(){console.log("Map.resize()");google.maps.event.trigger(e,"resize");e.setCenter(c)};google.maps.event.addListener(e,"zoom_changed",function(){console.log("maps 'zoom_changed' event fired");f=null;l()});var m;google.maps.event.addListener(e,"bounds_changed",function(){console.log("maps 'bounds_changed' event fired");if(m!==undefined){clearTimeout(m)}m=setTimeout(l,300);f=e.getBounds()});return b};var initialize=function(){console.log("initialize()");var a="http://shoutbreak.com:8080";var b=$("#map");var c=new Map(b);var d=500;var e=new SB(c,a,d);$("#slider li").css("width",$(window).width()+"px");$("#slider").easySlider({auto:true,continuous:true,numeric:true,pause:8e3,speed:800});$(".toggle_map").click(function(){console.log("toggleMap()");$("#layer5").toggle();c.resize()});$("#disclaimer_button").click(function(){$("#map_blanket").toggle()})};$(initialize)
